"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4681],{74749:function(e,n,r){r.d(n,{J:function(){return s}});var t=r(87066),s=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-1",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"-1";return t.Z.get("/get/getposts",{baseURL:e,params:{course_id:n,start:r}}).then((function(e){return e.data}))}},24681:function(e,n,r){r.d(n,{Z:function(){return X}});var t=r(47568),s=r(14924),o=r(26042),i=r(69396),a=r(97582),l=r(85893),c=r(47041),u=r(23138),d=r(35773),m=r(95305),f=r(39886),v=r(47911),p=r(54610),h=r(89885),g=r(96076),x=r(67294),b=r(74749),j=r(41609),_=r.n(j),y=r(46970),N=r(58533),w=r(82670),k=r(29815),Z=r(84082),S=r(60994),C=r(87261),E=r(26683),M=r(83024),H=r(60766),A=r(89355),L=r(24271),R=r(73716),I=r(30381),z=r.n(I),F=r(97340),U=r(91444),O=r(23879),D=r(84747),P=r(59417),G=r(67814),T="#6d6d6d",V="#000000",B=function(e){var n=e.message,r=e.postId,t=(0,x.useState)(!1),s=t[0],o=t[1],i=(0,x.useState)([]),a=i[0],c=i[1],u=(0,x.useState)(!1),d=u[0],m=u[1],f=function(){return m(!d)},v=(0,x.useRef)(null),p=(0,x.useContext)(h.Z),g=p.currentUser,b=p.appConfig,j=(0,L.G5)(b.web_firebaseconfig),y=(0,A.N8)(j),N=(0,x.useRef)({messages:[]});(0,x.useEffect)((function(){if(null===g||void 0===g?void 0:g.userid){var e=(0,A.iH)(y,"/feedComments/".concat(r,"/").concat(n.key,"/replies")),t=(0,A.iH)(y,"/data/user_block_status/"+g.userid);try{(0,A.jM)(t,(function(e){var n=e.val();o(!0===n)})),(0,A.yv)(e,(function(e){var n=e.val();n.key=e.key,N.current.messages.find((function(e){return e.key===n.key}))||(N.current.messages.push(n),c((0,k.Z)(N.current.messages)))}))}catch(s){console.error("error in fetching replies",s)}return function(){(0,A.S1)(t,"value"),(0,A.S1)(e,"child_added"),N.current.messages=[]}}}),[g]);var w=function(){if(!s&&v.current&&(null===g||void 0===g?void 0:g.userid)&&(null===g||void 0===g?void 0:g.name)){var e=v.current.value,t=(0,R.MI)(e);if(!_()(null===t||void 0===t?void 0:t.trim())){if((0,R.$N)(e))return v.current.value=t,void U.Am.warn("URLs are not allowed",{position:"bottom-right"});var o={userName:g.name,userComment:t,postedAt:(new Date).getTime(),userId:g.userid},i=(0,A.iH)(y,"/feedComments/".concat(r,"/").concat(n.key,"/replies")),a=(0,A.VF)(i);(0,A.t8)(a,o).then((function(){v.current&&(v.current.value="")})).catch((function(e){console.error("error in sending reply",e)}))}}};return(0,l.jsx)("div",{className:"chatmsg",children:(0,l.jsx)("div",{className:"col-md-12 col-xs-12 m-t-10",children:(0,l.jsxs)("div",{className:"messages msg_sent rounded-1",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("span",{className:"font-semi-bold me-2",children:[n.userName,":"]}),(0,l.jsx)(F.Z,{options:{target:"_blank",rel:"noopener noreferrer"},children:(0,R.i5)(n.userComment)})]}),(0,l.jsxs)("div",{className:"d-flex align-items-end",children:[(0,l.jsx)(Z.Z,{color:"link",size:"sm",onClick:f,className:"p-0 me-3 border-0 text-gra text-decoration-none",children:"Reply"}),n.replies&&n.replies.length>0&&(0,l.jsxs)(Z.Z,{color:"link",size:"sm",onClick:f,className:"p-0 border-0 text-gra text-decoration-none",children:[d?"Hide":"View"," replies (",n.replies.length,")"]}),(0,l.jsx)("time",{className:"text-gray font-xs ms-auto",children:z()(n.postedAt).format("DD MMM hh:mmA")})]}),d&&(0,l.jsxs)("div",{className:"border-top mt-2 px-2 pt-2",children:[null===a||void 0===a?void 0:a.map((function(e){return(0,l.jsxs)("div",{className:"pb-2",children:[(0,l.jsxs)("span",{className:"font-semi-bold me-2",children:[e.userName,":"]}),(0,l.jsx)(F.Z,{options:{target:"_blank",rel:"noopener noreferrer"},children:(0,R.i5)(e.userComment)})]},e.key)})),(0,l.jsxs)(S.Z,{children:[(0,l.jsx)(C.Z,{type:"text",placeholder:"Write your reply here ...",innerRef:v,bsSize:"sm",onKeyDown:function(e){return"Enter"===e.key&&w()},name:"typedMessage",className:"mb-0 font-sm",autoFocus:!0,disabled:s}),(0,l.jsx)(Z.Z,{color:"light",className:"border font-sm px-3",id:"btn-chat",disabled:s,onClick:w,children:"Send"})]})]})]})})})},J=function(e){var n=e.postId,r=e.isLiked,s=e.likesCount,o=e.onLikeToggle,i=(0,x.useContext)(h.Z),c=i.currentUser,u=i.toggleAuthModal,d=i.setIsLogin,m=i.appConfig,f=(0,x.useState)(!1),v=f[0],p=f[1],g=(0,x.useState)([]),b=g[0],j=g[1],y=(0,x.useState)(!1),N=y[0],I=y[1],z=(0,x.useRef)(null),F=(0,x.useRef)(null),J=(0,x.useRef)({messages:[]}),K=(0,L.G5)(m.web_firebaseconfig);(0,A.N8)(K);(0,x.useEffect)((function(){var e=(0,A.N8)(K),r=(0,A.iH)(e,"/feedComments/".concat(n)),t=(0,A.iH)(e,"/data/user_block_status/"+(null===c||void 0===c?void 0:c.userid));try{(0,A.jM)(t,(function(e){var n=e.val();I(!0===n)})),(0,A.yv)(r,(function(e){var n=e.val();n.key=e.key,n.replies&&(n.replies=Object.values(n.replies)),J.current.messages.push(n),j((0,k.Z)(J.current.messages))}))}catch(s){console.error("Error in fetching comments:",(0,w.Z)(s,Error)?s.message:String(s))}return function(){try{(0,A.S1)(r,"child_added"),(0,A.S1)(t,"value")}catch(s){console.error("Error in unsubscribing from comments:",(0,w.Z)(s,Error)?s.message:String(s))}J.current.messages=[]}}),[c,n]),(0,x.useEffect)((function(){F.current&&W()}),[b]);var W=function(){F.current&&F.current.scrollTo({top:F.current.scrollHeight,behavior:"smooth"})},$=function(){var e=(0,t.Z)((function(){return(0,a.__generator)(this,(function(e){return c?(o(n,!r),[2]):(d(!0),u(),[2])}))}));return function(){return e.apply(this,arguments)}}(),q=function(){if(!N&&z.current){var e=z.current.value,r=(0,R.MI)(e);if(!_()(null===r||void 0===r?void 0:r.trim())){if((0,R.$N)(e))return z.current.value=r,void U.Am.warn("URLs are not allowed",{position:"bottom-right"});var t={userName:(null===c||void 0===c?void 0:c.name)||"Anonymous",userComment:r,postedAt:(new Date).getTime(),userId:(null===c||void 0===c?void 0:c.userid)||""};try{var s=(0,A.N8)(K),o="/feedComments/".concat(n);(0,A.VF)((0,A.iH)(s,o),{}).then((function(e){if(!e.key)throw new Error("Failed to generate key for new message");var n=e.key,r=(0,A.iH)(s,o+"/"+n);(0,A.t8)(r,t).then((function(){z.current&&(z.current.value="")})).catch((function(e){console.error("Error setting message data:",(0,w.Z)(e,Error)?e.message:String(e)),U.Am.error("Failed to send message. Please try again.")}))})).catch((function(e){console.error("Error pushing new message:",(0,w.Z)(e,Error)?e.message:String(e)),U.Am.error("Failed to send message. Please try again.")}))}catch(i){console.error("Error in sending message:",(0,w.Z)(i,Error)?i.message:String(i)),U.Am.error("Failed to send message. Please try again.")}}}};return(0,l.jsxs)("div",{className:"feed-interactions",children:[(0,l.jsxs)("div",{className:"d-flex align-items-center",children:[(0,l.jsxs)("button",{className:"btn btn-like d-flex align-items-center",style:{color:r?V:T,border:"none",outline:"none",background:"none",padding:0,marginRight:"1rem"},onClick:$,children:[(0,l.jsx)(O.rx,{style:{color:r?V:T,fontSize:"18px"}}),(0,l.jsx)("span",{className:"ml-1",style:{color:r?V:T,fontSize:"14px"},children:(0,D.Z)(s)})]}),(0,l.jsx)(Z.Z,{color:"link",className:"p-0",style:{color:T},onClick:function(){if(!c)return d(!0),void u();p(!0)},children:(0,l.jsx)(G.G,{icon:P.lXL,style:{fontSize:"16px"}})})]}),(0,l.jsxs)(E.Z,{isOpen:v,toggle:function(){return p(!1)},size:"lg",className:"rounded-0 modal-content-rounded-2",children:[(0,l.jsx)(M.Z,{className:"rounded-0",toggle:function(){return p(!1)},children:(0,l.jsx)("div",{className:"p-0",children:"Comments"})}),(0,l.jsx)(H.Z,{className:"p-0",children:(0,l.jsxs)("div",{className:"panel panel-default rounded-1",children:[(0,l.jsx)("div",{className:"panel-body msg_container_base font-sm rounded-1",ref:F,style:{maxHeight:"400px",overflowY:"auto"},children:b.map((function(e,r){return(0,l.jsx)(B,{message:e,postId:n},r)}))}),(0,l.jsx)("div",{className:"panel-footer rounded-1",children:(0,l.jsxs)(S.Z,{children:[(0,l.jsx)(C.Z,{type:"text",placeholder:"Write your comment here ...",innerRef:z,onKeyDown:function(e){return"Enter"===e.key&&q()},name:"typedMessage",className:"mb-0",disabled:N}),(0,l.jsx)(Z.Z,{color:"primary",id:"btn-chat",onClick:q,disabled:N,children:"Send"})]})})]})})]})]})},K=r(22490),W=r(24631),$=function(e){var n=e.optionCount,r=void 0===n?4:n;return(0,l.jsxs)("div",{className:"mt-3 rounded-lg shadow-sm border border-gray-200 bg-white overflow-hidden",children:[(0,l.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("div",{className:"w-3 h-3 bg-gray-200 rounded-full animate-slow-pulse"}),(0,l.jsx)("div",{className:"h-5 bg-gray-200 rounded-full w-3/4 animate-slow-pulse"})]})}),(0,l.jsx)("div",{className:"p-3 space-y-3",children:Array.from({length:r}).map((function(e,n){return(0,l.jsxs)("div",{className:"flex items-center space-x-3 p-3",children:[(0,l.jsx)("div",{className:"flex-shrink-0 w-5 h-5 bg-gray-200 rounded-full animate-slow-pulse"}),(0,l.jsx)("div",{className:"flex-grow",children:(0,l.jsx)("div",{className:"h-4 bg-gray-200 rounded-full animate-slow-pulse w-full"})})]},n)}))})]})};function q(e){var n=e.postId,r=e.firebase,o=(0,x.useState)(null),i=o[0],c=o[1],u=(0,x.useState)([]),d=u[0],m=u[1],f=(0,x.useState)(null),v=f[0],p=f[1],g=(0,x.useState)(!1),b=g[0],j=g[1],_=(0,x.useState)(!0),y=_[0],N=_[1],w=(0,x.useContext)(h.Z).currentUser,k=(0,x.useCallback)((function(e){if(i&&e){var n=Array.from({length:i.totalOptions}).map((function(n,r){return e["option_".concat(r)]||0})).reduce((function(e,n){return e+n}),0),r=Array.from({length:i.totalOptions}).map((function(r,t){var s,o;return{id:t,option:i.options[t],votes:n>0?Math.round((e["option_".concat(t)]||0)/n*100):0,selected:null===v||void 0===v||null===(s=v.selected_option_answers)||void 0===s?void 0:s.includes(t),isCorrect:null===(o=i.answer)||void 0===o?void 0:o.includes(t)}}));m(r)}}),[i,null===v||void 0===v?void 0:v.selected_option_answers]),Z=function(){var e=(0,t.Z)((function(e){var t,o,l,c,u,d,m;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:if(!w||!(null===i||void 0===i?void 0:i.is_voting_on)||b||v)return[2];j(!0),a.label=1;case 1:return a.trys.push([1,4,5,6]),o=(0,A.N8)(r),l=(0,A.iH)(o,"data/posts_poll/post_".concat(n,"/user_answers/user_").concat(w.userid)),[4,(0,A.U2)(l)];case 2:return a.sent().exists()?[2]:(c={is_correct:null===(t=i.answer)||void 0===t?void 0:t.includes(e),name:w.name,selected_option_answers:[e],selected_option_text:[i.options[e]],source:"website"},u={},(0,s.Z)(u,"active_poll_answer/option_".concat(e),(0,A.nP)(1)),(0,s.Z)(u,"user_answers/user_".concat(w.userid),c),d=u,[4,(0,A.Vx)((0,A.iH)(o,"data/posts_poll/post_".concat(n)),d)]);case 3:return a.sent(),p(c),[3,6];case 4:return m=a.sent(),console.error("Error voting:",m),[3,6];case 5:return j(!1),[7];case 6:return[2]}}))}));return function(n){return e.apply(this,arguments)}}();if((0,x.useEffect)((function(){if(r){var e=(0,A.N8)(r),t=(0,A.iH)(e,"data/posts_poll/post_".concat(n,"/active_poll")),s=(0,A.iH)(e,"data/posts_poll/post_".concat(n,"/active_poll_answer")),o=!1,i=!1,a=function(){o&&i&&N(!1)};(0,A.jM)(t,(function(e){c(e.val()),o=!0,a()}));var l=[];if(w){var u=(0,A.iH)(e,"data/posts_poll/post_".concat(n,"/user_answers/user_").concat(w.userid));(0,A.jM)(u,(function(e){var n=e.val();n&&p(n),i=!0,a()}));l.push((function(){return(0,A.S1)(u)}))}else i=!0,a();return(0,A.jM)(s,(function(e){k(e.val())})),function(){(0,A.S1)(t),(0,A.S1)(s),l.forEach((function(e){return e()}))}}}),[n,r,null===w||void 0===w?void 0:w.userid]),y)return(0,l.jsx)($,{optionCount:(null===i||void 0===i?void 0:i.totalOptions)||4});if(!i)return null;var S=!!v;return(0,l.jsxs)("div",{className:"mt-3 rounded-lg shadow-sm border border-gray-200 bg-white",children:[(0,l.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,l.jsxs)("h6",{className:"flex items-center text-lg font-medium",children:[(0,l.jsx)(G.G,{icon:P.diR,className:"mr-2 ".concat(i.is_voting_on?"text-green-500 animate-pulse":"text-red-500"),size:"xs"}),i.question]})}),(0,l.jsx)("div",{className:"p-2 rounded-e-md",children:S||!i.is_voting_on?i.options.map((function(e,n){var r,t,s=null===v||void 0===v||null===(r=v.selected_option_answers)||void 0===r?void 0:r.includes(n),o=null===(t=i.answer)||void 0===t?void 0:t.includes(n);d.find((function(e){return e.id===n}));return(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)("div",{className:"p-3 rounded-lg ".concat(o?"bg-green-100 border border-green-300":""," ").concat(s&&!o?"bg-red-100 border border-red-300":""," ").concat(!S||s||o?"":"border border-gray-400"),children:(0,l.jsx)("div",{className:"flex justify-between items-center",children:(0,l.jsxs)("span",{className:"".concat(s?"font-medium":""),children:[e,s&&o&&(0,l.jsx)("span",{className:"ml-2 text-green-600",children:"\u2713"}),s&&!o&&(0,l.jsx)("span",{className:"ml-2 text-red-600",children:"\u2717"})]})})}),o&&!s&&(0,l.jsx)("div",{className:"mt-1 text-sm text-green-600",children:"Correct answer"})]},n)})):i.options.map((function(e,n){return(0,l.jsx)("button",{className:"w-full mb-2 p-3 text-left rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors ".concat(b?"opacity-50 cursor-not-allowed":""),onClick:function(){return Z(n)},disabled:b||S,children:e},n)}))})]})}function X(e){var n=e.posts,r=e.courseId,j=void 0===r?0:r,w=(0,x.useContext)(h.Z),k=w.appConfig,Z=w.currentUser,S=w.toggleAuthModal,C=(0,x.useState)(),E=C[0],M=C[1],H=(0,x.useState)((null===n||void 0===n?void 0:n.data)||[]),R=H[0],I=H[1],z=(0,x.useState)((null===n||void 0===n?void 0:n.total)||0),F=z[0],U=z[1],O=(0,x.useState)(0),D=O[0],P=O[1],G=(0,x.useState)(null),T=G[0],V=G[1],B=(0,x.useState)(new Set),$=B[0],X=B[1],Y=(0,x.useState)(new Set),Q=Y[0],ee=Y[1],ne=(0,x.useState)({}),re=ne[0],te=ne[1],se=function(){var e=(0,t.Z)((function(){var e,r,t,s;return(0,a.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),e=(0,c.getCookie)(g.z1),r=n?D+10:0,[4,(0,b.J)(e,"".concat(j),"".concat(r))];case 1:return t=o.sent(),P(r),I((function(e){return e.concat(t.data)})),U(t.total),[3,3];case 2:return s=o.sent(),console.error(s),[3,3];case 3:return[2]}}))}));return function(){return e.apply(this,arguments)}}(),oe=(0,L.G5)(k.web_firebaseconfig);(0,x.useEffect)((function(){V(oe)}),[oe]);var ie=(0,x.useMemo)((function(){return T?(0,A.N8)(T):null}),[T]);(0,x.useEffect)((function(){if((null===Z||void 0===Z?void 0:Z.userid)&&T&&ie){var e=(0,A.iH)(ie,"userPostLikes/".concat(Z.userid));(0,A.U2)(e).then((function(e){var n=new Set(Object.keys(e.val()||{}));ee(n)}));var n=(0,A.iH)(ie,"feedLikeCount");(0,A.U2)(n).then((function(e){te(e.val()||{})}))}}),[Z,T]);var ae=function(){var e=(0,t.Z)((function(e,n){var r,t,l;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:if(!ie||!(null===Z||void 0===Z?void 0:Z.userid)||$.has(e))return[2];X((function(n){return new Set(n).add(e)})),r=(0,A.iH)(ie,"userPostLikes/".concat(Z.userid,"/").concat(e)),t=(0,A.iH)(ie,"feedLikeCount/".concat(e)),a.label=1;case 1:return a.trys.push([1,8,9,10]),ee((function(r){var t=new Set(r);return n?t.add(e):t.delete(e),t})),te((function(r){return(0,i.Z)((0,o.Z)({},r),(0,s.Z)({},e,n?(r[e]||0)+1:Math.max(0,(r[e]||0)-1)))})),n?[4,(0,A.t8)(r,!0)]:[3,4];case 2:return a.sent(),[4,(0,A.i3)(t,(function(e){return(e||0)+1}))];case 3:return a.sent(),[3,7];case 4:return[4,(0,A.Od)(r)];case 5:return a.sent(),[4,(0,A.i3)(t,(function(e){return Math.max(0,(e||0)-1)}))];case 6:a.sent(),a.label=7;case 7:return[3,10];case 8:return l=a.sent(),console.error("Error updating like:",l),ee((function(r){var t=new Set(r);return n?t.delete(e):t.add(e),t})),te((function(r){return(0,i.Z)((0,o.Z)({},r),(0,s.Z)({},e,n?Math.max(0,(r[e]||0)-1):(r[e]||0)+1))})),[3,10];case 9:return X((function(n){var r=new Set(n);return r.delete(e),r})),[7];case 10:return[2]}}))}));return function(n,r){return e.apply(this,arguments)}}();return(0,x.useEffect)((function(){n||se()}),[n]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(N.Z,{dataLength:(null===R||void 0===R?void 0:R.length)||0,next:se,hasMore:F>=10,loader:(0,l.jsx)("div",{className:"text-center text-gray font-bold",children:"Loading.."}),endMessage:0!=(null===R||void 0===R?void 0:R.length)?(0,l.jsx)("div",{className:"text-center text-gray font-bold"}):(0,l.jsx)(u.Z,{color:"primary",isOpen:!0,children:"No items found"}),children:(0,l.jsx)(d.Z,{className:"justify-content-center m-0",children:(0,l.jsx)(m.Z,{md:{size:6},children:(null===R||void 0===R?void 0:R.length)>0?R.map((function(e){return(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsxs)(f.Z,{className:"overflow-hidden",children:[(0,l.jsx)("div",{onClick:function(n){return r=e,void(_()(r.url)?_()(r.video_url)||(Z?M({file_link:r.video_url,live_status:3,media_id:"",download_link:r.video_url,download_posts:"",embed_url:"",download_links:[]}):S()):window.open(r.url,"_blank"));var r},className:"cursor-pointer",children:!_()(e.image_url)&&(0,l.jsx)(v.Z,{top:!0,style:{maxHeight:"350px",objectFit:"contain"},width:"100%",src:e.image_url,alt:e.title})}),(0,l.jsxs)(p.Z,{children:[(0,l.jsx)("h1",{className:"font-l font-bold mb-0 text-xl",children:e.title}),(0,l.jsx)(W.y,{text:e.description})]}),(0,K.h)(e.has_poll)&&(0,l.jsx)(q,{postId:e.id,firebase:T}),(0,K.h)(k.web_enableFeedInteractions)&&(0,l.jsx)(p.Z,{className:"border-top py-1",children:(0,l.jsx)(J,{postId:e.id,isLiked:Q.has(e.id),likesCount:re[e.id]||0,onLikeToggle:ae})})]})},e.id)})):(0,l.jsx)(u.Z,{color:"primary",children:"No posts yet"})})})}),Boolean(E)&&Z&&(0,l.jsx)(y.Z,{isOpen:Boolean(E),toggle:function(){return M(void 0)},currentVideoRecord:E})]})}}}]);